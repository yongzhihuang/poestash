javascript:var linkbackBanner="http://www.randomdit.com/poe/poebanner.png";var league,index=1,buyouts="",standard="",hasOnlyBuyOut=!1,existingShopdata="",hasBoth=!1;function init(){$("body,html").animate({scrollTop:0},800);showOverlay()}
function getTabs(){var b="",c=[];$.ajax({type:"GET",url:"http://www.pathofexile.com/character-window/get-stash-items?league="+league+"&tabs=1&tabIndex="+index--,success:function(a){$.each(a.tabs,function(a,d){tabvalue=d.i+1;tabName=d.n;b+='<div class="tabsItem" data-tabNumber ="'+tabvalue+'" data-tabName = "'+tabName+'"></div>';c.push(d.src)});$(".userStashes").append(b);$(".stashInstruction").show();$(".userStashes .tabsItem").css({display:"inline-block",height:"26px","margin-right":"10px",position:"relative",
"background-position":"0px 51px"});a=$(".userStashes .tabsItem");$.each(a,function(d,a){var b=$(this),e=new Image;e.onload=function(){b.css("min-width",this.width+"px")};e.src=c[d];$(this).css({"background-image":"url("+c[d]+")"})});a.hover(function(){$(this).css({cursor:"pointer","background-position":"0px 50px"})},function(){$(this).css({cursor:"pointer","background-position":"0px 51px"})});$(".btnGenerate").show();var d=[],e=[],f=[];a.click(function(){var c=$(this).data("tabnumber"),a=$(this).data("tabname");
if(confirm("Click OK to make this tab its own spoiler group (good for buy out tabs)")){$(this).addClass("ownTab");var b=prompt("Enter a custom name for your tab:",a);""!==b?f.push(b):f.push(a)}if($(this).hasClass("selected")){$(this).removeClass("selected");$(this).css({border:"none"});for(a=d.length-1;0<=a;a--)d[a]===c&&d.splice(a,1);for(a=e.length-1;0<=a;a--)e[a]===c&&e.splice(a,1)}else $(this).addClass("selected"),$(this).css({border:"solid 2px"}),$(this).hasClass("ownTab")&&$(this).css({"border-color":"green"}),
$(this).hasClass("ownTab")?-1===$.inArray(c,e)&&e.push(c):-1===$.inArray(c,d)&&d.push(c)});$(".btnGenerate").click(function(){0<e.length?fetchBuyoutTab(e,f,function(){fetchItems(d)}):fetchItems(d)})},error:function(a){alert("Sorry either there seems to be no stashes in this league or you are nog logged in",index)}})}
function deleteFromShop(b){var c=localStorage.poestashShops,a=[],c=c.split("|");$.each(c,function(c,b){a.push(b)});for(c=a.length-1;0<=c;c--)a[c]===b&&a.splice(c,1);c=a.join("|");localStorage.poestashShops=c}
function getShops(){var b=[],c="",a=localStorage.poestashShops;a&&(a=a.split("|"),$.each(a,function(a,c){b.push(c)}));$.each(b,function(a,b){if(""!==b){var f=b.split("--");c+='<li><a href="'+f[1]+'" target="_blank">'+f[0]+"</a> ("+f[2]+') [<a href="#" class="deleteShopItem" data-itemdata="'+(f[0]+"--"+f[1]+"--"+f[2])+'">x</a>]'}});return c}
function saveToShop(b){localStorage.poestashShops=localStorage.poestashShops?localStorage.poestashShops+b:b;b=getShops();$(".shoplist").html(b);updateShopDataEvent()}
function showOverlay(){$("body").prepend('<div class="overlay"><div class="donateButton"><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="9NFZS9PMPKBSE"><input type="image"src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"></form></div><div class="byline">Visit Official: <a href="http://pathofexilestash.blogspot.com">PoeStash</a></div><div class="twitterfollow" style="background: white;width: 500px;color: black;margin: 0 auto;margin-bottom: 10px;margin-top: 10px;border-radius: 4px;font-size: 15px;">Follow us <a href="https://twitter.com/Poestash" target="_blank">@poestash</a> for update announcements and questions</div><div class="close" style="display: inline;position: absolute;right: 149px;">[x]</div><div class="sellon" style="font-size:19px">Sell on: <a href="http://www.pathofexile.com/forum/new-thread/306">Standard</a> | <a href="http://www.pathofexile.com/forum/new-thread/305">Hardcore</a> | <a href=" http://www.pathofexile.com/forum/new-thread/427">Domination</a> | <a href="http://www.pathofexile.com/forum/new-thread/430">Nemesis</a></div><h3>PoeStash</h3><p>Select your character league:</p><div class="leagueBtnContainer"><div class="leagueBtn" data-league ="Standard">Standard</div><div class="leagueBtn" data-league ="Hardcore">Hardcore</div><div class="leagueBtn" data-league ="Domination">Domination</div><div class="leagueBtn" data-league ="Nemesis">Nemesis</div></div><div class="userStashes"><span class="stashInstruction">Select your stash:</span></div><div class="btnGenerate" style="display:none">Generate</div><div class="myshops-container" style="max-width: 680px; margin: 0 auto; margin-bottom: 20px"><h3>My Shops</h3>Shop Name:<input type="text" id="shopname" class="shoptxtbox">Shop URL:<input type="text" id="shopurl" class="shoptxtbox">Shop League:<input type="text" id="shopleague" class="shoptxtbox"><div class="addShop medButton">Add</div><div class="myshops" style="margin-top: 10px;border:solid 1px; text-align:left;padding:10px"><ul class="shoplist"></ul></div></div><div class="note">Note: if your post does not update, try to hit refresh, most likely it is the forum autosave feature interrupting with the bookmarklet.</div><div class="contact">Comments and suggestions: <a href="http://pathofexilestash.blogspot.com/">Official Website</a> | <a href="http://www.reddit.com/r/pathofexile/comments/1tw8xz/tool_introducing_poestash_shop_creatormanager/">Reddit Post</a> | <a href="http://www.pathofexile.com/forum/view-thread/729127">Poe Forum</a></div></div>');$(".overlay .donateButton").css({"padding-top":"20px"});
$(".overlay h3").css({"font-size":"65px","font-family":"FontinSmallCaps, Verdana, Arial, Helvetica, sans-serif","padding-top":"2%"});$(".leagueBtnContainer").css({"margin-top":"30px"});$(".overlay .leagueBtn").css({"font-size":"25px","padding-left":"10px",display:"inline",padding:"5px",border:"solid 1px","margin-right":"10px"});$(".medButton").css({"font-size":"25px","padding-left":"10px",display:"inline",padding:"5px",border:"solid 1px","margin-left":"10px"});$(".userStashes").css({"margin-top":"30px",
"max-width":"500px",margin:"30px auto"});$(".stashInstruction").css({position:"relative",top:"-10px",display:"none"});$(".btnGenerate").css({"font-size":"28px",padding:"10px",border:"solid 1px",width:"200px",margin:"0 auto","margin-bottom":"30px"});$(".overlay").css({"min-height":"1200px",width:"100%",background:"black","z-index":"100000",opacity:"0.85",position:"absolute","text-align":"center"});$(".shoptxtbox").css({"margin-left":"5px","margin-right":"5px",width:"100px",background:"black",border:"solid 1px rgb(163, 141, 109)",
"font-size":"25px",color:"rgb(163, 141, 109)"});$(".addShop").click(function(c){c.preventDefault();c=$("#shopname").val();var a=$("#shopurl").val(),b=$("#shopleague").val(),e="";""===c||""===a||""===b?alert("Please complete all fields in order to add"):(-1===a.indexOf("http://")&&(a="http://"+a),e="|"+c+"--"+a+"--"+b,$("#shopname").val(""),$("#shopurl").val(""),$("#shopleague").val(""));saveToShop(e)});$(".btnGenerate").hover(function(){$(this).hasClass("leagueSelected")||$(this).css({cursor:"pointer",
background:"rgb(80,22,7)"})},function(){$(this).hasClass("leagueSelected")||$(this).css({background:"black"})});$(".medButton").hover(function(){$(this).css({cursor:"pointer",background:"rgb(80,22,7)"})},function(){$(this).css({background:"black"})});$(".leagueBtn").hover(function(){$(this).hasClass("leagueSelected")||$(this).css({cursor:"pointer",background:"rgb(80,22,7)"})},function(){$(this).hasClass("leagueSelected")||$(this).css({background:"black"})});$(".close").hover(function(){$(this).hasClass("leagueSelected")||
$(this).css({cursor:"pointer",color:"white"})},function(){$(this).hasClass("leagueSelected")||$(this).css({color:"rgb(163, 141, 109)"})});$(".close").click(function(){$(".overlay").remove()});$(".leagueBtn").click(function(){league=$(this).data("league");index=1;$(this).hasClass("leagueSelected")?$(this).css({background:"black"}):($(this).addClass("leagueSelected"),$(this).css({background:"rgb(255,200,0)"}));$(this).siblings().css({background:"black"});$(this).siblings().removeClass("leagueSelected");
getTabs()});var b=getShops();$(".shoplist").append(b);$(".deleteShopItem").click(function(b){b.preventDefault();b=$(this).data("itemdata");deleteFromShop(b);$(this).parent().slideUp()})}function updateShopDataEvent(){$(".deleteShopItem").click(function(b){b.preventDefault();b=$(this).data("itemdata");deleteFromShop(b);$(this).parent().slideUp()})}
function fetchBuyoutTab(b,c,a){var d=[],e=$("textarea").text();$.each(b,function(b,g){$.ajax({type:"GET",async:!1,url:"http://www.pathofexile.com/character-window/get-stash-items?league="+league+"&tabs=1&tabIndex="+--g,success:function(b){d.push(b.items);buyouts=generationCustomTabBBCode(d,c,function(){a()});hasOnlyBuyOut?(""!==e?(b=$("textarea").text(),b=b.replace(/-.+-/ig,buyouts),$("textarea").text(b)):$("textarea").text("Welcome to [name of your shop]:\n\nMessage me in game: [your ign]\n\nFeatured Items:\n\n-"+
buyouts+"-\n[url=http://pathofexilestash.blogspot.com/][img]"+linkbackBanner+"[/img][/url]\n\n"),$(".overlay").fadeOut()):hasBoth=!0}})})}function fetchItems(b,c){var a=[],d=b.length,e=[],f=0;0===b.length?hasOnlyBuyOut=!0:$.each(b,function(b,c){$.ajax({type:"GET",url:"http://www.pathofexile.com/character-window/get-stash-items?league="+league+"&tabs=1&tabIndex="+--c,success:function(b){a.push(b.items);f++;f===d&&($.each(a,function(b,c){a[b]&&(e=$.merge(e,a[b]))}),generateBBCode(e))}})})}
function generationCustomTabBBCode(b,c,a){var d=[],e=[],f="",g="";$.each(b,function(b,a){f="";$.each(a,function(b,a){var e=a.inventoryId,g=a.x,h=a.y,l={};l.coordinates='x="'+g+'" y="'+h+'"';l.location=e;d[c[b]]||(d[c[b]]=[]);d[c[b]].push(l);f+='[linkItem location="'+e+'" league="'+league+'" x="'+g+'" y="'+h+'"]'});e.push(f)});$.each(e,function(b,a){a=a.toString().replace(/undefined/ig,"");g+='[spoiler="'+c[b]+'"]'+a+"[/spoiler]"});a();return g}
function generateBBCode(b){$("textarea").text();var c={Weapons:"Bow Dagger OneHandAxe OneHandMace OneHandSword Sceptre Staff ThrustingOneHandSword TwoHandAxe TwoHandMace TwoHandSword Wand".split(" "),Armour:["BodyArmour","Boot","Glove","Helmet","Shield"],Jewellery:["Amulet","Belt","Ring"],Other:["Other","Currency"],Gem:["Gem"],Flask:["Flask"],Map:["Map"]},a=[],d={};$.each(b,function(b,d){var e=d.inventoryId,f=d.x,g=d.y,l="Other",h={data:{},category:{}},k=d.icon.split("/"),l=k[k.length-2];"Support"===
l&&(l=k[k.length-3]);"gen"===k[3]&&(l="Flasks");$.each(c,function(b,a){$.each(a,function(a,c){"Currency"!==c&&(c+="s");l===c&&(h.parentCategory=b)})});h.data.coordinates='x="'+f+'" y="'+g+'"';h.data.location=e;h.category=l;a.push(h)});var e="Weapons Armour Jewellery Other Gem Flask Map".split(" "),f="Bow;Dagger;OneHandAxe;OneHandMace;OneHandSword;Sceptre;Staff;Thrusting OneHandSword;TwoHandAxe;TwoHandMace;TwoHandSword;Wand;BodyArmour;Boot;Glove;Helmet;Shield;Amulet;Belt;Ring;Other;Currency;Gem;Flask;Map".split(";");
$.each(a,function(b,a){$.each(e,function(b,c){a.parentCategory===c&&$.each(f,function(b,c){"Currency"!==c&&(c+="s");a.category===c&&(d[a.category]||(d[a.category]={}),d[a.category].data||(d[a.category].data={}),d[a.category].parent||(d[a.category].parent={}),d[a.category].data+='[linkItem location="'+a.data.location+'" league="'+league+'" '+a.data.coordinates+"]",d[a.category].parent=a.parentCategory)})})});var g={};$.each(d,function(a,b){var c=d[a].parent;g[c]||(g[c]={});g[c][a]||(g[c][a]={});g[c][a]=
d[a].data});var k="",h={};$.each(g,function(a,b){$.each(b,function(b,c){h[a]||(h[a]={});h[a]+='[spoiler="'+b+'"]'+c+"[/spoiler]"})});$.each(h,function(a,b){h!=={}&&(k+='[spoiler="'+a+'"]'+b+"[/spoiler]")});k=k.toString().replace(/\[object Object]/ig,"");""!==$("textarea").text()?(!0===hasBoth?b=$("textarea").text():(b=$("textarea").text(),b=b.replace(/-.+-/ig,k)),$("textarea").text(b)):$("textarea").text("Welcome to [name of your shop]\n\nMessage me in game: [your ign]\n\nFeatured Items:[Add your featured items manually]\n\n-"+
buyouts+k+"-\n[url=http://pathofexilestash.blogspot.com/][img]"+linkbackBanner+"[/img][/url]\n\n");$(".overlay").fadeOut()}init();